(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[4408],{3905:function(e,n,t){"use strict";t.d(n,{Zo:function(){return c},kt:function(){return h}});var o=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function a(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},s=Object.keys(e);for(o=0;o<s.length;o++)t=s[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)t=s[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=o.createContext({}),p=function(e){var n=o.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=p(e.components);return o.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},d=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,c=a(e,["components","mdxType","originalType","parentName"]),d=p(t),h=r,m=d["".concat(l,".").concat(h)]||d[h]||u[h]||s;return t?o.createElement(m,i(i({ref:n},c),{},{components:t})):o.createElement(m,i({ref:n},c))}));function h(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var s=t.length,i=new Array(s);i[0]=d;var a={};for(var l in n)hasOwnProperty.call(n,l)&&(a[l]=n[l]);a.originalType=e,a.mdxType="string"==typeof e?e:r,i[1]=a;for(var p=2;p<s;p++)i[p]=t[p];return o.createElement.apply(null,i)}return o.createElement.apply(null,t)}d.displayName="MDXCreateElement"},1603:function(e,n,t){"use strict";t.r(n),t.d(n,{frontMatter:function(){return i},metadata:function(){return a},toc:function(){return l},default:function(){return c}});var o=t(2122),r=t(9756),s=(t(7294),t(3905)),i={id:"understanding-session",title:"Understanding Session",sidebar_label:"Understanding Session"},a={unversionedId:"introduction/understanding-session",id:"version-legacy/introduction/understanding-session",isDocsHomePage:!1,title:"Understanding Session",description:"When a GraphQL request arrives at GraphQL Modules, GraphQL Modules creates a scope only for that network request.",source:"@site/versioned_docs/version-legacy/introduction/understanding-session.md",sourceDirName:"introduction",slug:"/introduction/understanding-session",permalink:"/docs/legacy/introduction/understanding-session",editUrl:"https://github.com/Urigo/graphql-modules/edit/master/website/versioned_docs/version-legacy/introduction/understanding-session.md",version:"legacy",sidebar_label:"Understanding Session",frontMatter:{id:"understanding-session",title:"Understanding Session",sidebar_label:"Understanding Session"},sidebar:"version-legacy/docs",previous:{title:"Implement Your Providers",permalink:"/docs/legacy/introduction/implement-providers"},next:{title:"Dependencies Between Modules",permalink:"/docs/legacy/introduction/dependencies"}},l=[{value:"Using in <code>express-graphql</code>",id:"using-in-express-graphql",children:[]},{value:"Using in <code>ApolloServer</code>",id:"using-in-apolloserver",children:[]},{value:"Using in another application that doesn&#39;t use GraphQL Modules on the top",id:"using-in-another-application-that-doesnt-use-graphql-modules-on-the-top",children:[]}],p={toc:l};function c(e){var n=e.components,t=(0,r.Z)(e,["components"]);return(0,s.kt)("wrapper",(0,o.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"When a GraphQL request arrives at GraphQL Modules, GraphQL Modules creates a scope only for that network request.\nGraphQL Modules identifies this scope by a unique object given in the global application context.\nThe global application context defined in your GraphQL server/library is not the same with the module's context, because all resolvers, context builders, dependency injections, etc. are encapsulated in the global application context."),(0,s.kt)("p",null,"You can decide how to pass the session object in your application's context-building phase."),(0,s.kt)("p",null,"GraphQL Modules tries to get the ",(0,s.kt)("inlineCode",{parentName:"p"},"session")," property of your global application context first, but if there is no ",(0,s.kt)("inlineCode",{parentName:"p"},"session")," property, it takes all application context objects as your network session objects."),(0,s.kt)("h3",{id:"using-in-express-graphql"},"Using in ",(0,s.kt)("inlineCode",{parentName:"h3"},"express-graphql")),(0,s.kt)("p",null,"For example, ",(0,s.kt)("inlineCode",{parentName:"p"},"express-graphql")," passes ",(0,s.kt)("inlineCode",{parentName:"p"},"express.Request")," by default as the global application context:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"const MyModule = new GraphQLModule({\n  context(session: express.Request) {\n    return {\n      authToken: session.headers.authorization,\n    };\n  },\n});\n\n// Some `express` code\napp.use(\n  '/graphql',\n  graphqlHTTP({\n    schema: MyModule.schema,\n  })\n);\n")),(0,s.kt)("p",null,"If we need more stuff in the network session:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"interface MyModuleSession {\n  req: express.Request,\n  res: express.Response\n}\nconst MyModule = new GraphQLModule({\n  context(session: MyModuleSession) {\n    session.res.on('finish', () => {\n      // Some cleanup\n    });\n    return {\n      authToken: session.req.headers.authorization,\n    };\n  }\n});\n// Some `express` code\napp.use('/graphql', graphqlHTTP((req, res) => ({\n  schema: MyModule.schema,\n  context: { session: { req, res }, /* other things will be ignored ... */ }\n  // or without the `session` property\n  context: { req, res }\n})));\n")),(0,s.kt)("h3",{id:"using-in-apolloserver"},"Using in ",(0,s.kt)("inlineCode",{parentName:"h3"},"ApolloServer")),(0,s.kt)("p",null,"On the other hand, ",(0,s.kt)("inlineCode",{parentName:"p"},"apollo-server")," needs to be passed it like below:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"new ApolloServer({\n  modules: [MyModule],\n  context: ({ req, res }) => ({ req, res }),\n  // or\n  context: ({ req, res }) => ({ session: { req, res } }),\n  // or\n  context: (session) => ({ session }),\n  // or\n  context: (session) => session,\n});\n")),(0,s.kt)("h3",{id:"using-in-another-application-that-doesnt-use-graphql-modules-on-the-top"},"Using in another application that doesn't use GraphQL Modules on the top"),(0,s.kt)("p",null,"Even if you want to use ",(0,s.kt)("inlineCode",{parentName:"p"},"GraphQLModule")," in a non-GraphQL-Modules application, you can safely pass the context builder of ",(0,s.kt)("inlineCode",{parentName:"p"},"GraphQLModule"),".\nAnd you can use the internal context of your ",(0,s.kt)("inlineCode",{parentName:"p"},"GraphQLModule")," including ",(0,s.kt)("strong",{parentName:"p"},"Dependency Injection"),".\nGraphQL Modules internally handles ",(0,s.kt)("inlineCode",{parentName:"p"},"session")," without the need of passing ",(0,s.kt)("inlineCode",{parentName:"p"},"session")," specifically."),(0,s.kt)("h4",{id:"using-modules-of-apolloserver"},"Using ",(0,s.kt)("inlineCode",{parentName:"h4"},"modules")," of ",(0,s.kt)("inlineCode",{parentName:"h4"},"ApolloServer")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"const MyAccountsModule = AccountsModule.forRoot({ ... });\nnew ApolloServer({\n  modules: [MyAccountsModule]\n  typeDefs: myTypeDefs,\n  resolvers: myResolvers,\n  context: ({ req, res }) => {\n    // My context stuff\n    return {\n      myContextProp: {...},\n      ...MyAccountsModule.context({ req, res })\n    }\n  }\n})\n")),(0,s.kt)("h4",{id:"using-schema-stitching"},"Using schema stitching"),(0,s.kt)("p",null,"You can safely extract reusable ",(0,s.kt)("inlineCode",{parentName:"p"},"typeDefs"),", ",(0,s.kt)("inlineCode",{parentName:"p"},"resolvers")," and ",(0,s.kt)("inlineCode",{parentName:"p"},"context")," from your ",(0,s.kt)("inlineCode",{parentName:"p"},"GraphQLModule"),", and use it outside ",(0,s.kt)("inlineCode",{parentName:"p"},"GraphQLModule"),"."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"import { mergeTypeDefs, mergeResolvers } from 'graphql-toolkit';\n\nconst MyAccountsModule = AccountsModule.forRoot({ ... });\n\nconst schema = mergeSchemas({\n  typeDefs: [\n    MyAccountsModule.typeDefs,\n    gql`\n      type Query {\n        someField: SomeType\n      }\n    `\n  ],\n  resolvers: [\n    MyAccountsModule.resolvers,\n    {\n      Query: {\n        someField: ...\n      }\n    }\n  ]\n});\n\napp.use('/graphql', graphqlHTTP({\n  schema,\n  graphiql: true\n}));\n")),(0,s.kt)("p",null,"This is what ",(0,s.kt)("inlineCode",{parentName:"p"},"Session")," means in GraphQL Modules.\nYou can read more about ",(0,s.kt)("strong",{parentName:"p"},(0,s.kt)("a",{parentName:"strong",href:"/docs/legacy/introduction/dependency-injection#provider-scopes"},"Provider Scopes"))," in the ",(0,s.kt)("strong",{parentName:"p"},"Dependency Injection")," section."))}c.isMDXComponent=!0}}]);