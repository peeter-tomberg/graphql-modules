(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[7165],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return u},kt:function(){return m}});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=o.createContext({}),l=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=l(e.components);return o.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),d=l(n),m=r,h=d["".concat(s,".").concat(m)]||d[m]||p[m]||a;return n?o.createElement(h,i(i({ref:t},u),{},{components:n})):o.createElement(h,i({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=d;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:r,i[1]=c;for(var l=2;l<a;l++)i[l]=n[l];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},3895:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return i},metadata:function(){return c},toc:function(){return s},default:function(){return u}});var o=n(2122),r=n(9756),a=(n(7294),n(3905)),i={id:"context",title:"Context",sidebar_label:"Context"},c={unversionedId:"introduction/context",id:"version-legacy/introduction/context",isDocsHomePage:!1,title:"Context",description:"In GraphQL, a context is an object shared by all the resolvers of a specific execution.",source:"@site/versioned_docs/version-legacy/introduction/context.md",sourceDirName:"introduction",slug:"/introduction/context",permalink:"/docs/legacy/introduction/context",editUrl:"https://github.com/Urigo/graphql-modules/edit/master/website/versioned_docs/version-legacy/introduction/context.md",version:"legacy",sidebar_label:"Context",frontMatter:{id:"context",title:"Context",sidebar_label:"Context"},sidebar:"version-legacy/docs",previous:{title:"Module Configuration",permalink:"/docs/legacy/introduction/configuration"},next:{title:"Resolvers Composition",permalink:"/docs/legacy/introduction/resolvers-composition"}},s=[{value:"Context Builders",id:"context-builders",children:[]}],l={toc:s};function u(e){var t=e.components,n=(0,r.Z)(e,["components"]);return(0,a.kt)("wrapper",(0,o.Z)({},l,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"In GraphQL, a context is an object shared by all the resolvers of a specific execution.\nIt's useful for keeping data such as authentication info, the current user, database connection, data sources and other things you need for running your business logic."),(0,a.kt)("p",null,"The context is available as the 3rd argument to each resolver:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"const resolvers = {\n  Query: {\n    myQuery: (root, args, context, info) => {},\n  },\n};\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"You can read more about resolver in ",(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("a",{parentName:"strong",href:"https://www.apollographql.com/docs/graphql-tools/resolvers#Resolver-function-signature"},"Apollo Server documentation")),".")),(0,a.kt)("p",null,"Since modules are isolated (see ",(0,a.kt)("a",{parentName:"p",href:"https://medium.com/the-guild/why-is-true-modular-encapsulation-so-important-in-large-scale-graphql-projects-ed1778b03600"},"why"),"), there is no common context unless you explicitly create one. In the ",(0,a.kt)("a",{parentName:"p",href:"https://www.apollographql.com/docs/apollo-server/security/authentication/#putting-user-info-on-the-context"},"case of authentication")," for example, you need to create an authentication module that places the authenticated user into the context, then explicitly import that authentication module from each module that uses authentication."),(0,a.kt)("p",null,"GraphQL Modules also uses the context; it adds to the context a field called ",(0,a.kt)("inlineCode",{parentName:"p"},"injector"),", which you can use to get access to the dependency injection container of your ",(0,a.kt)("inlineCode",{parentName:"p"},"GraphQLModule"),"."),(0,a.kt)("p",null,"You can use the ",(0,a.kt)("inlineCode",{parentName:"p"},"injector")," from any resolver like that:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { ModuleContext } from '@graphql-modules/core';\n\nexport default {\n  Query: {\n    myQuery: (_, args, { injector }: ModuleContext) =>\n      injector.get(MyProvider).doSomething(),\n  },\n};\n")),(0,a.kt)("h3",{id:"context-builders"},"Context Builders"),(0,a.kt)("p",null,"In addition to the added ",(0,a.kt)("inlineCode",{parentName:"p"},"injector"),", GraphQL Modules lets you add custom fields to the ",(0,a.kt)("inlineCode",{parentName:"p"},"context"),"."),(0,a.kt)("p",null,"Each module can have its own ",(0,a.kt)("inlineCode",{parentName:"p"},"context")," function, which takes the network session that contains the request, the current context and the injector and can extend the GraphQL ",(0,a.kt)("inlineCode",{parentName:"p"},"context")," with any field."),(0,a.kt)("p",null,"To add a custom ",(0,a.kt)("inlineCode",{parentName:"p"},"context")," to your ",(0,a.kt)("inlineCode",{parentName:"p"},"GraphQLModule"),", do the following:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { GraphQLModule } from '@graphql-modules/core';\nimport * as typeDefs from './schema.graphql';\nimport resolvers from './resolvers';\n\nexport interface IMyModuleContext {\n  myField: string;\n}\n\nexport const MyModule = new GraphQLModule<{}, {}, IMyModuleContext>({\n  typeDefs,\n  resolvers,\n  context: (session, currentContext, moduleSessionInfo) => {\n    return {\n      myField: 'some-value',\n    };\n  },\n});\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Your custom context-building function should return either ",(0,a.kt)("inlineCode",{parentName:"p"},"object")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise<object>"),".")),(0,a.kt)("p",null,"Then, in any of your resolvers, you can access it this way:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { ModuleContext } from '@graphql-modules/core';\nimport { IMyModuleContext } from './my-module';\n\nexport default {\n  Query: {\n    myQuery: (_, args, { myField }: ModuleContext<IMyModuleContext>) =>\n      injector.get(MyProvider).doSomething(myField),\n  },\n};\n")),(0,a.kt)("p",null,"You can also use this feature to implement authentication easily; you just access the network session, write async code, and return the current user, which is added to the ",(0,a.kt)("inlineCode",{parentName:"p"},"context"),". For example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { GraphQLModule, Injector } from '@graphql-modules/core';\nimport * as typeDefs from './schema.graphql';\nimport resolvers from './resolvers';\nimport { AuthenticationProvider } from './auth-provider';\n\nexport interface User {\n  firstName: string;\n  lastName: string;\n}\n\nexport interface ISession {\n  req: express.Request;\n  res: express.Response;\n}\n\nexport const AuthModule = new GraphQLModule({\n  typeDefs,\n  resolvers,\n  providers: [AuthenticationProvider],\n  async context(session: ISession, currentContext, { injector }) {\n    const authToken = session.req.headers.authentication;\n    const currentUser = injector\n      .get(AuthenticationProvider)\n      .authorizeUser(authToken);\n    return {\n      currentUser,\n    };\n  },\n});\n")),(0,a.kt)("p",null,"See also the article ",(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("a",{parentName:"strong",href:"https://medium.com/the-guild/authentication-and-authorization-in-graphql-and-how-graphql-modules-can-help-fadc1ee5b0c2"},"Authentication and Authorization in GraphQL (and how GraphQL-Modules can help)")),"."))}u.isMDXComponent=!0}}]);